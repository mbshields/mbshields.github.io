
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-8.5.10">
    
    
      
        <title>Configuration - Sveltos Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.472b142f.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.08040f6c.min.css">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="None" data-md-color-accent="None">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#configuration-and-operation" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Sveltos Documentation" class="md-header__button md-logo" aria-label="Sveltos Documentation" data-md-component="logo">
      
  <img src="../assets/images/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Sveltos Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Configuration
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Sveltos Documentation" class="md-nav__button md-logo" aria-label="Sveltos Documentation" data-md-component="logo">
      
  <img src="../assets/images/logo.png" alt="logo">

    </a>
    Sveltos Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../introduction/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../getting-started/" class="md-nav__link">
        Getting Started
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Configuration
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Configuration
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#cluster-selection" class="md-nav__link">
    Cluster Selection
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sync-modes" class="md-nav__link">
    Sync Modes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dry-run-mode" class="md-nav__link">
    Dry Run Mode
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#snapshots-and-rollback" class="md-nav__link">
    Snapshots and Rollback
  </a>
  
    <nav class="md-nav" aria-label="Snapshots and Rollback">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rollback" class="md-nav__link">
    Rollback
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#managed-features" class="md-nav__link">
    Managed Features
  </a>
  
    <nav class="md-nav" aria-label="Managed Features">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configmaps-and-secrets" class="md-nav__link">
    ConfigMaps and Secrets
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#helm-charts" class="md-nav__link">
    Helm charts
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#list-helm-charts-and-resources-deployed-in-a-capi-cluster" class="md-nav__link">
    List helm charts and resources deployed in a CAPI Cluster.
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#detecting-conflicts" class="md-nav__link">
    Detecting conflicts
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#getting-started-on-any-kubernetes-cluster" class="md-nav__link">
    Getting started on any Kubernetes cluster
  </a>
  
    <nav class="md-nav" aria-label="Getting started on any Kubernetes cluster">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deploy-yaml" class="md-nav__link">
    Deploy YAML
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-crd-and-deployment" class="md-nav__link">
    Install CRD and Deployment
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#uninstall-crds" class="md-nav__link">
    Uninstall CRDs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#undeploy-controller" class="md-nav__link">
    Undeploy controller
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../contributing/" class="md-nav__link">
        Contributing
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../license/" class="md-nav__link">
        License
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#cluster-selection" class="md-nav__link">
    Cluster Selection
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sync-modes" class="md-nav__link">
    Sync Modes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dry-run-mode" class="md-nav__link">
    Dry Run Mode
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#snapshots-and-rollback" class="md-nav__link">
    Snapshots and Rollback
  </a>
  
    <nav class="md-nav" aria-label="Snapshots and Rollback">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rollback" class="md-nav__link">
    Rollback
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#managed-features" class="md-nav__link">
    Managed Features
  </a>
  
    <nav class="md-nav" aria-label="Managed Features">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configmaps-and-secrets" class="md-nav__link">
    ConfigMaps and Secrets
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#helm-charts" class="md-nav__link">
    Helm charts
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#list-helm-charts-and-resources-deployed-in-a-capi-cluster" class="md-nav__link">
    List helm charts and resources deployed in a CAPI Cluster.
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#detecting-conflicts" class="md-nav__link">
    Detecting conflicts
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#getting-started-on-any-kubernetes-cluster" class="md-nav__link">
    Getting started on any Kubernetes cluster
  </a>
  
    <nav class="md-nav" aria-label="Getting started on any Kubernetes cluster">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deploy-yaml" class="md-nav__link">
    Deploy YAML
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-crd-and-deployment" class="md-nav__link">
    Install CRD and Deployment
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#uninstall-crds" class="md-nav__link">
    Uninstall CRDs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#undeploy-controller" class="md-nav__link">
    Undeploy controller
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="configuration-and-operation">Configuration and Operation</h1>
<p><img src="../assets/images/logo.png" width="200"></p>
<p>The main features of Sveltos include:</p>
<ul>
<li><a href="#markdown-header-cluster-selection">Flexible cluster selection</a></li>
<li><a href="#markdown-header-sync-modes">Sync Modes</a>: One Time or Continuous </li>
<li><a href="#markdown-header-dry-run">Dry Run</a></li>
<li><a href="#markdown-header-snapshotting">Snapshots and Rollback</a></li>
<li><a href="#markdown-detecting-conflicts">Detecting Conflicts</a></li>
<li>[Declarative API and CLI]</li>
</ul>
<h2 id="cluster-selection">Cluster Selection</h2>
<p>The <code>clusterSelector</code> field is a Kubernetes <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/#resources-that-support-set-based-requirements">label selector</a> that matches against labels on CAPI clusters.</p>
<blockquote>
<p>Example:  <code>clusterSelector: env=prod</code></p>
</blockquote>
<h2 id="sync-modes">Sync Modes</h2>
<p>The <code>syncMode</code> field has three possible options. <code>Continuous</code> and <code>OneTime</code> are explained below. <code>DryRun</code> is explained in a separate section.</p>
<blockquote>
<p>Example:  <code>syncMode: Continuous</code></p>
</blockquote>
<ul>
<li>OneTime</li>
</ul>
<p>Upon deployment of a <code>ClusterProfile</code> with a <code>syncMode</code> configuration of <code>OneTime</code>, all CAPI clusters are checked for a <code>clusterSelector</code> match, and all matching clusters will have the current <code>ClusterProfile</code>-specified features installed at that time.</p>
<p>Any subsequent changes to the <code>ClusterProfile</code> features will not be deployed into the already matching CAPI clusters.</p>
<ul>
<li>Continuous</li>
</ul>
<p>When the <code>syncMode</code> configuration is <code>Continuous</code>, any new changes made to the <code>ClusterProfile</code>-specified features are immediately reconciled into the matching CAPI clusters.</p>
<p>Reconciliation consists of one of these actions on matching clusters: 
  - deploy a feature -- whenever a feature is added to the ClusterProfile or when a CAPI cluster newly matches the ClusterProfile
  - update a feature -- whenever the ClusterProfile configuration changes or any referenced ConfigMap/Secret changes
  - remove a feature -- whenever a Helm release or a ConfigMap/Secret is deleted from the ClusterProfile</p>
<ul>
<li>DryRun</li>
</ul>
<p>See <a href="#markdown-header-dry-run-mode">Dry Run Mode</a>.</p>
<h2 id="dry-run-mode">Dry Run Mode</h2>
<p>Before adding, modifying, or deleting a ClusterProfile, it is often useful to see what changes will result. When you deploy a <code>ClusterProfile</code> with a <code>syncMode</code> configuration of <code>DryRun</code>, a workflow is launched that will simulate all of the operations that would be executed in an actual run. No actual code is executed in the dry run workflow, and there are no side effects. The dry run workflow generates a list of potential changes for each matching CAPI cluster, allowing you to inspect and validate these changes before deploying the new <code>ClusterProfile</code> configuration.</p>
<p>You can see the change list by viewing a generated Custom Resource Definition (CRD) named <em>ClusterReport</em>, but it is much easier to view the list using a  <a href="https://github.com/projectsveltos/sveltosctl">sveltosctl</a> CLI command, as shown in the following example:</p>
<pre><code>./bin/sveltosctl show dryrun
+-------------------------------------+--------------------------+-----------+----------------+-----------+--------------------------------+------------------+
|               CLUSTER               |      RESOURCE TYPE       | NAMESPACE |      NAME      |  ACTION   |            MESSAGE             | CLUSTER FEATURES |
+-------------------------------------+--------------------------+-----------+----------------+-----------+--------------------------------+------------------+
| default/sveltos-management-workload | helm release             | kyverno   | kyverno-latest | Install   |                                | dryrun           |
| default/sveltos-management-workload | helm release             | nginx     | nginx-latest   | Install   |                                | dryrun           |
| default/sveltos-management-workload | :Pod                     | default   | nginx          | No Action | Object already deployed.       | dryrun           |
|                                     |                          |           |                |           | And policy referenced by       |                  |
|                                     |                          |           |                |           | ClusterProfile has not changed |                  |
|                                     |                          |           |                |           | since last deployment.         |                  |
| default/sveltos-management-workload | kyverno.io:ClusterPolicy |           | no-gateway     | Create    |                                | dryrun           |
+-------------------------------------+--------------------------+-----------+----------------+-----------+--------------------------------+------------------+
</code></pre>
<p>For a demonstration of dry run mode, watch the video <a href="https://www.youtube.com/watch?v=gfWN_QJAL6k&amp;t=4s">Sveltos, introduction to DryRun mode</a> on YouTube.</p>
<h2 id="snapshots-and-rollback">Snapshots and Rollback</h2>
<p>The snapshot feature allows you to capture a complete policy configuration at an instant in time. Using snapshots from different times, you can see what configuration changes occurred between two timestamps, and you can roll back and forward policy configurations to any saved configuration snapshot.</p>
<p>Operations using snapshots, such as capture, diff, and rollback, are performed with the Sveltos command line interface, <code>sveltosctl</code>.</p>
<p>For a demonstration of snapshots, watch the video <a href="https://www.youtube.com/watch?v=ALcp1_Nj9r4">Sveltos, introduction to Snapshots</a> on YouTube.</p>
<h3 id="rollback">Rollback</h3>
<p>Rollback is when a previous configuration snapshot is used to replace the current configuration deployed by ClusterProfiles. Rollback can be executed with the following granularities:
1. namespace: Rolls back only ConfigMaps/Secrets and Cluster labels in this namespace. If no namespace is specified, all namespaces are updated.
2. cluster: Rolls back only labels for a cluster with this name. If no cluster name is specified, labels for all clusters are updated.
3. clusterprofile: Rolls back only ClusterProfiles with this name. If no ClusterProfile name is specified, all ClusterProfiles are updated.</p>
<p>When all of the configuration files for a particular version are used to replace the current configuration, this is referred to as a full rollback.</p>
<p>For a demonstration of rollback, watch the video <a href="https://www.youtube.com/watch?v=sTo6RcWP1BQ">Sveltos, introduction to Rollback mode</a> on YouTube.</p>
<h2 id="managed-features">Managed Features</h2>
<p>The purpose of Sveltos is to deploy features selectively to specified CAPI clusters. The features to be deployed can be Helm charts, Kubernetes Secrets, or Kubernetes ConfigMaps. In the example below, one of each type of feature is deployed. </p>
<p>In this example, we want to deploy specific features into a subset of CAPI clusters: those that are labeled with <em>env: prod</em>. We first create a <code>ClusterProfile</code> instance, such as the YAML file shown below. In the instance, we specify an appropriate <code>clusterSelector</code> to match with the intended CAPI clusters. We then specify the desired features to be deployed into the selected CAPI clusters.</p>
<p>Using the example <code>ClusterProfile</code>, Sveltos will direct Kubernetes to ensure that any CAPI cluster with the label <em>env: prod</em> will have the following features deployed:
*  a Helm chart (version v2.5.0) for installing Kyverno
*  a Kubernetes resource(s) contained in the referenced Secret: <em>default/storage-class</em>
*  a Kubernetes resource(s) contained in the referenced ConfigMap: <em>default/contour</em></p>
<pre><code>apiVersion: config.projectsveltos.io/v1alpha1
kind: ClusterProfile
metadata:
  name: demo
spec:
  clusterSelector: env=prod
  syncMode: Continuous
  helmCharts:
  - repositoryURL: https://kyverno.github.io/kyverno/
    repositoryName: kyverno
    chartName: kyverno/kyverno
    chartVersion: v2.5.0
    releaseName: kyverno-latest
    releaseNamespace: kyverno
    helmChartAction: Install
 policyRefs:
  - name: storage-class
    namespace: default
    kind: Secret
  - name: contour-gateway
    namespace: default
    kind: ConfigMap
</code></pre>
<h3 id="configmaps-and-secrets">ConfigMaps and Secrets</h3>
<p>ConfigMaps and Secrets contain Kubernetes resources that can be deployed in CAPI clusters. </p>
<ul>
<li>A Kubernetes <a href="https://kubernetes.io/docs/concepts/configuration/configmap/">ConfigMap</a> stores non-confidential data in key-value pairs.</li>
<li>A Kubernetes <a href="https://kubernetes.io/docs/concepts/configuration/secret/">Secret</a> is similar to a ConfigMap, but is used to store sensitive data.</li>
</ul>
<p>ConfigMaps and Secrets are listed and identified by name, namespace, and kind in the <code>policyRefs</code> section of the <code>ClusterProfile</code>. </p>
<p>The data field of a ConfigMap or Secret can be a list of key-value pairs. Any key is acceptable, and the value can be multiple objects, described in YAML or JSON format. </p>
<p>The following YAML file is an example of the <em>contour-gateway</em> ConfigMap, which  is referenced by our example <code>ClusterProfile</code>. When Sveltos deploys this ConfigMap as part of our <code>ClusterProfile</code>, a GatewayClass and Gateway instance are automatically deployed in any matching CAPI cluster.</p>
<pre><code>apiVersion: v1
kind: ConfigMap
metadata:
  name: contour-gateway
  namespace: default
data:
  gatewayclass.yaml: |
    kind: GatewayClass
    apiVersion: gateway.networking.k8s.io/v1beta1
    metadata:
      name: contour
    spec:
      controllerName: projectcontour.io/projectcontour/contour
  gateway.yaml: |
    kind: Namespace
    apiVersion: v1
    metadata:
      name: projectcontour
    ---
    kind: Gateway
    apiVersion: gateway.networking.k8s.io/v1beta1
    metadata:
     name: contour
     namespace: projectcontour
    spec:
      gatewayClassName: contour
      listeners:
        - name: http
          protocol: HTTP
          port: 80
          allowedRoutes:
            namespaces:
              from: All
</code></pre>
<h3 id="helm-charts">Helm charts</h3>
<p><a href="https://helm.sh">Helm</a> is a CNCF graduated project that serves as a package manager widely used in the Kubernetes community. Helm uses "charts" to orchestrate the deployment of a set of Kubernetes resources. </p>
<p>Helm charts to be deployed by Sveltos are listed in the <code>helmCharts</code> section of the <code>ClusterProfile</code>. Sveltos uses the <a href="helm.sh/helm/v3/pkg">Helm golang SDK</a> to deploy all Helm charts listed in a <code>ClusterProfile</code> instance.</p>
<h3 id="list-helm-charts-and-resources-deployed-in-a-capi-cluster">List helm charts and resources deployed in a CAPI Cluster.</h3>
<p>There is many-to-many mapping between Clusters and ClusterProfile: 
- Multiple ClusterProfiles can match with a CAPI cluster; 
- Multiple CAPI clusters can match with a single ClusterProfile.</p>
<p>As for DryRun, <a href="https://github.com/projectsveltos/sveltosctl">sveltosctl</a> can be used to properly list all deployed features per CAPI cluster:</p>
<pre><code>./bin/sveltosctl show features
+-------------------------------------+--------------------------+-----------+----------------+---------+-------------------------------+------------------+
|               CLUSTER               |      RESOURCE TYPE       | NAMESPACE |      NAME      | VERSION |             TIME              | CLUSTER PROFILES |
+-------------------------------------+--------------------------+-----------+----------------+---------+-------------------------------+------------------+
| default/sveltos-management-workload | helm chart               | kyverno   | kyverno-latest | v2.5.0  | 2022-10-11 20:59:18 -0700 PDT | mgianluc         |
| default/sveltos-management-workload | helm chart               | nginx     | nginx-latest   | 0.14.0  | 2022-10-11 20:59:25 -0700 PDT | mgianluc         |
| default/sveltos-management-workload | helm chart               | mysql     | mysql          | 9.3.3   | 2022-10-11 20:43:41 -0700 PDT | mgianluc         |
| default/sveltos-management-workload | :Pod                     | default   | nginx          | N/A     | 2022-10-12 09:33:25 -0700 PDT | mgianluc         |
| default/sveltos-management-workload | kyverno.io:ClusterPolicy |           | no-gateway     | N/A     | 2022-10-12 09:33:25 -0700 PDT | mgianluc         |
+-------------------------------------+--------------------------+-----------+----------------+---------+-------------------------------+------------------+
</code></pre>
<p>Otherwise, a new CRD is introduced to easily summarize which features (either helm charts or kubernetes resources) are deployed in a given CAPI cluster because of one or more ClusterProfiles.
Such CRD is called <em>ClusterConfiguration</em>.</p>
<p>There is exactly only one ClusterConfiguration for each CAPI Cluster.</p>
<p>Following example shows us that because of ClusterProfile <em>demo</em> three helm charts and one Kyverno ClusterPolicy were deployed.</p>
<pre><code>apiVersion: v1
items:
- apiVersion: config.projectsveltos.io/v1alpha1
  kind: ClusterConfiguration
  metadata:
    creationTimestamp: &quot;2022-09-19T21:14:15Z&quot;
    generation: 1
    name: sveltos-management-workload
    namespace: default
    ownerReferences:
    - apiVersion: config.projectsveltos.io/v1alpha1
      kind: ClusterProfile
      name: demo2
      uid: f0f93440-95ae-4663-aff7-3b27c1135dfc
    resourceVersion: &quot;45488&quot;
    uid: efa326cb-a7e0-401c-918f-0a9252033856
  status:
    clusterProfileResources:
    - Features:
      - charts:
        - appVersion: v1.7.0
          chartName: kyverno-latest
          chartVersion: v2.5.0
          lastAppliedTime: &quot;2022-09-19T21:14:16Z&quot;
          namespace: kyverno
          repoURL: https://kyverno.github.io/kyverno/
        - appVersion: 2.3.0
          chartName: nginx-latest
          chartVersion: 0.14.0
          lastAppliedTime: &quot;2022-09-19T21:14:23Z&quot;
          namespace: nginx
          repoURL: https://helm.nginx.com/stable
        - appVersion: 1.22.1
          chartName: contour
          chartVersion: 9.1.2
          lastAppliedTime: &quot;2022-09-19T21:17:31Z&quot;
          namespace: projectcontour
          repoURL: https://charts.bitnami.com/bitnami
        featureID: Helm
      - featureID: Resources
        resources:
        - group: kyverno.io
          kind: ClusterPolicy
          lastAppliedTime: &quot;2022-09-19T21:20:18Z&quot;
          name: no-gateway
          owner:
            kind: ConfigMap
            name: kyverno-disallow-gateway
            namespace: default
      clusterProfileName: demo
</code></pre>
<h2 id="detecting-conflicts">Detecting conflicts</h2>
<p>Multiple ClusterProfiles can match same CAPI cluster. Because of that misconfiguration can happen and need to be detected.</p>
<p>For instance:
1. ClusterProfile A references ConfigMap A containing a Kyverno ClusterPolicy called <em>no-gateway"
2. ClusterProfile B references ConfigMap B containing a Kyverno ClusterPolicy called </em>no-gateway"</p>
<p>In such case, ClusterProfile will be allowed to deploy the Kyverno ClusterPolicy, while ClusterProfile B will report a conflict.</p>
<p>Note that in following example there is no conflict since both ClusterProfiles are referencing same ConfigMap:
1. ClusterProfile A references ConfigMap A containing a Kyverno ClusterPolicy called <em>no-gateway"
2. ClusterProfile B references ConfigMap A containing a Kyverno ClusterPolicy called </em>no-gateway"</p>
<p>Another example of misconfiguration is when two different ClusterProfiles match same CAPI Cluster(s) and both want to deploy same Helm chart in the same namespace.</p>
<p>In such a case, only one ClusterProfile will be elected and given permission to manage a specific helm release in a given CAPI cluster. Other ClusterProfiles will report such misconfiguration.</p>
<h2 id="getting-started-on-any-kubernetes-cluster">Getting started on any Kubernetes cluster</h2>
<p>You can use <a href="https://sigs.k8s.io/kind">KIND</a> to get a local cluster for testing, or run against a remote cluster.</p>
<p>First you need to install ClusterAPI in such cluster. <a href="https://cluster-api.sigs.k8s.io/user/quick-start.html">ClusterAPI instruction</a> can be followed.</p>
<p>Second you need to install the CRD and Deployment for the project in the management cluster:</p>
<h3 id="deploy-yaml">Deploy YAML</h3>
<p>You can post the YAML to the management cluster</p>
<pre><code>kubectl create -f  https://raw.githubusercontent.com/projectsveltos/cluster-api-feature-manager/master/manifest/manifest.yaml
</code></pre>
<h3 id="install-crd-and-deployment">Install CRD and Deployment</h3>
<ol>
<li>. Deploy the controller to the cluster with the image specified by <code>IMG</code>:</li>
</ol>
<pre><code class="language-sh">make deploy IMG=&lt;some-registry&gt;/cluster-api-feature-manager:tag
</code></pre>
<h3 id="uninstall-crds">Uninstall CRDs</h3>
<p>To delete the CRDs from the cluster:</p>
<pre><code class="language-sh">make uninstall
</code></pre>
<h3 id="undeploy-controller">Undeploy controller</h3>
<p>UnDeploy the controller to the cluster:</p>
<pre><code class="language-sh">make undeploy
</code></pre>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../getting-started/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Getting Started" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Getting Started
            </div>
          </div>
        </a>
      
      
        
        <a href="../contributing/" class="md-footer__link md-footer__link--next" aria-label="Next: Contributing" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Contributing
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2022
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.d6c3db9e.min.js"></script>
      
    
  </body>
</html>